<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的待办清单</title>

    <style>
        /* 全局样式 - 设置基础样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, "Microsoft YaHei", sans-serif;
            background-color: #ffffff; /* 纯白背景 */
            min-height: 100vh;
            padding: 20px;
            color: #1f2937;
        }

        /* 主容器 - 页面居中显示 */
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #ffffff; /* 纯白背景 */
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08); /* 更柔和的阴影 */
            padding: 30px;
        }

        /* 页面标题 */
        h1 {
            text-align: center;
            color: #3b82f6; /* 蓝色主色调 */
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: 600;
        }

        /* 输入区域 - 添加新任务 */
        .input-section {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        /* 输入框 */
        #taskInput {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e5e7eb; /* 浅灰色边框 */
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        #taskInput:focus {
            outline: none;
            border-color: #3b82f6; /* 蓝色边框 */
        }

        /* 添加按钮 */
        #addBtn {
            padding: 12px 24px;
            background-color: #3b82f6; /* 蓝色主色调 */
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #addBtn:hover {
            background-color: #2563eb; /* 悬停时深蓝色 */
        }

        /* 任务列表容器 */
        .task-list {
            list-style: none;
        }

        /* 单个任务项 - 每一条任务（圆角卡片风格） */
        .task-item {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            background-color: #ffffff; /* 纯白背景 */
            border: 1px solid #e5e7eb; /* 浅灰色边框 */
            border-radius: 12px; /* 更大的圆角 */
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); /* 更轻柔的阴影 */
            transition: all 0.2s ease;
        }

        .task-item:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); /* 悬停时的阴影效果 */
            border-color: #3b82f6; /* 悬停时显示蓝色边框 */
        }

        /* 任务内容 */
        .task-content {
            flex: 1;
            font-size: 16px;
            color: #2d3748;
            transition: all 0.3s ease; /* 添加过渡动画 */
        }

        /* 已完成任务的样式 */
        .task-content.completed {
            text-decoration: line-through; /* 删除线 */
            color: #9ca3af; /* 灰色文字 */
        }

        /* 操作按钮 - 完成和删除按钮 */
        .task-actions {
            display: flex;
            gap: 8px;
        }

        /* 按钮基础样式 */
        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        /* 完成按钮 */
        .complete-btn {
            background-color: #3b82f6; /* 蓝色主色调 */
            color: white;
        }

        .complete-btn:hover {
            background-color: #2563eb; /* 悬停时深蓝色 */
        }

        /* 删除按钮 */
        .delete-btn {
            background-color: #ef4444; /* 红色警示色 */
            color: white;
        }

        .delete-btn:hover {
            background-color: #dc2626; /* 悬停时深红色 */
        }

        /* 清空已完成按钮 - 批量删除已完成的任务 */
        .clear-completed-btn {
            width: 100%;
            padding: 12px;
            background-color: #f3f4f6; /* 浅灰色背景 */
            color: #6b7280; /* 灰色文字 */
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 20px;
            display: none; /* 默认隐藏 */
        }

        .clear-completed-btn:hover {
            background-color: #e5e7eb; /* 悬停时稍深的灰色 */
            color: #4b5563;
        }

        .clear-completed-btn.show {
            display: block; /* 显示按钮 */
        }

        /* 响应式设计 - 手机端适配 */
        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }

            h1 {
                font-size: 24px;
            }

            .input-section {
                flex-direction: column;
            }

            #addBtn {
                width: 100%;
            }

            .task-item {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }

            .task-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 页面标题 -->
        <h1>我的待办清单</h1>

        <!-- 输入区域 - 用于添加新任务 -->
        <div class="input-section">
            <input type="text" id="taskInput" placeholder="输入新任务..." />
            <button id="addBtn">添加</button>
        </div>

        <!-- 任务列表区域 -->
        <ul class="task-list">
            <!-- 任务列表为空时会显示提示 -->
        </ul>

        <!-- 清空已完成按钮 - 批量删除已完成的任务 -->
        <button class="clear-completed-btn">清空已完成</button>
    </div>

    <script>
        // 获取DOM元素 - 这些是我们需要操作的页面元素
        const taskInput = document.getElementById('taskInput');  // 输入框
        const addBtn = document.getElementById('addBtn');  // 添加按钮
        const taskList = document.querySelector('.task-list');  // 任务列表容器
        const clearCompletedBtn = document.querySelector('.clear-completed-btn');  // 清空已完成按钮

        // 保存任务到 localStorage - 数据持久化
        function saveTasks() {
            // 获取所有任务项
            const taskItems = document.querySelectorAll('.task-item');
            // 创建一个数组来存储所有任务数据
            const tasks = [];

            // 遍历每个任务项，提取任务信息
            taskItems.forEach(item => {
                const taskContent = item.querySelector('.task-content');
                const taskText = taskContent.textContent;  // 任务内容
                const isCompleted = taskContent.classList.contains('completed');  // 完成状态

                // 将任务信息添加到数组中
                tasks.push({
                    text: taskText,
                    completed: isCompleted
                });
            });

            // 将任务数组转换为 JSON 字符串并保存到 localStorage
            localStorage.setItem('todoList', JSON.stringify(tasks));
            // 中文注释：JSON.stringify() 把 JavaScript 对象转换成字符串，这样才能保存到 localStorage
        }

        // 从 localStorage 加载任务 - 页面加载时调用
        function loadTasks() {
            // 从 localStorage 读取保存的任务数据
            const savedTasks = localStorage.getItem('todoList');

            if (savedTasks) {
                // 如果有保存的数据，解析 JSON 字符串为 JavaScript 数组
                const tasks = JSON.parse(savedTasks);
                // 中文注释：JSON.parse() 把字符串转换回 JavaScript 对象

                // 遍历所有任务，重新创建任务列表
                tasks.forEach(taskData => {
                    // 创建新的任务项元素
                    const newTaskItem = document.createElement('li');
                    newTaskItem.className = 'task-item';

                    // 根据完成状态设置不同的样式和按钮文字
                    const completedClass = taskData.completed ? 'completed' : '';
                    const buttonText = taskData.completed ? '取消' : '完成';

                    // 设置任务项的 HTML 内容
                    newTaskItem.innerHTML = `
                        <span class="task-content ${completedClass}">${taskData.text}</span>
                        <div class="task-actions">
                            <button class="btn complete-btn">${buttonText}</button>
                            <button class="btn delete-btn">删除</button>
                        </div>
                    `;

                    // 将任务添加到列表中
                    // 如果是已完成的任务，直接添加到末尾（底部）
                    // 如果是未完成的任务，添加到顶部
                    if (taskData.completed) {
                        taskList.appendChild(newTaskItem);
                    } else {
                        taskList.insertBefore(newTaskItem, taskList.firstChild);
                    }
                });
            }
        }

        // 删除任务函数 - 从列表中移除单个任务
        function deleteTask(deleteButton) {
            // deleteButton 是被点击的删除按钮
            // parentElement 是按钮所在的任务项（<li class="task-item">）
            const taskItem = deleteButton.parentElement.parentElement;
            // 从任务列表中移除这个任务项
            taskItem.remove();

            // 删除后也保存数据
            saveTasks();
        }

        // 为所有删除按钮添加事件监听 - 包括已有的和新建的
        function setupDeleteButtons() {
            // 选择所有的删除按钮
            const deleteButtons = document.querySelectorAll('.delete-btn');

            // 为每个删除按钮添加点击事件
            deleteButtons.forEach(button => {
                // 如果已经添加了事件监听，先移除（防止重复）
                button.removeEventListener('click', handleDeleteClick);
                // 添加新的点击事件
                button.addEventListener('click', handleDeleteClick);
            });
        }

        // 删除按钮点击处理函数
        function handleDeleteClick(event) {
            // 调用删除任务函数，传入被点击的按钮
            deleteTask(event.target);
            // 删除后更新清空按钮显示状态
            updateClearCompletedButton();
        }

        // 更新清空已完成按钮的显示状态
        function updateClearCompletedButton() {
            // 选择所有已完成的任务（有completed类的元素）
            const completedTasks = document.querySelectorAll('.task-content.completed');

            if (completedTasks.length > 0) {
                // 如果有已完成的任务，显示按钮
                clearCompletedBtn.classList.add('show');
            } else {
                // 如果没有已完成的任务，隐藏按钮
                clearCompletedBtn.classList.remove('show');
            }
        }

        // 清空所有已完成的任务
        function clearCompletedTasks() {
            // 选择所有已完成的任务项（<li class="task-item">）
            const completedTaskItems = document.querySelectorAll('.task-list .task-content.completed');

            // 遍历每个已完成的任务，删除其所在的任务项
            completedTaskItems.forEach(completedContent => {
                const taskItem = completedContent.parentElement; // 获取任务项
                taskItem.remove(); // 删除任务项
            });

            // 删除后隐藏按钮
            clearCompletedBtn.classList.remove('show');

            // 保存数据到 localStorage
            saveTasks();
        }

        // 切换任务完成状态 - 标记为已完成或取消完成
        function toggleComplete(completeButton) {
            // completeButton 是被点击的完成/取消按钮
            // 找到任务项（<li class="task-item">）
            const taskItem = completeButton.parentElement.parentElement;
            // 找到任务内容元素（<span class="task-content">）
            const taskContent = taskItem.querySelector('.task-content');
            // 检查任务是否已完成（是否有completed类）
            const isCompleted = taskContent.classList.contains('completed');

            if (isCompleted) {
                // 如果已完成，则取消完成
                taskContent.classList.remove('completed');  // 移除删除线和灰色
                completeButton.textContent = '完成';  // 按钮文字变回"完成"
            } else {
                // 如果未完成，则标记为完成
                taskContent.classList.add('completed');  // 添加删除线和灰色
                completeButton.textContent = '取消';  // 按钮文字变成"取消"

                // 将已完成的任务移到列表底部
                // appendChild 会将已存在的元素移动到末尾
                taskList.appendChild(taskItem);
            }

            // 更新清空按钮显示状态
            updateClearCompletedButton();

            // 保存任务状态到 localStorage
            saveTasks();
        }

        // 为所有完成按钮添加事件监听
        function setupCompleteButtons() {
            // 选择所有的完成按钮
            const completeButtons = document.querySelectorAll('.complete-btn');

            // 为每个完成按钮添加点击事件
            completeButtons.forEach(button => {
                // 移除已有的事件监听（防止重复）
                button.removeEventListener('click', handleCompleteClick);
                // 添加新的点击事件
                button.addEventListener('click', handleCompleteClick);
            });
        }

        // 完成按钮点击处理函数
        function handleCompleteClick(event) {
            // 调用切换完成状态函数，传入被点击的按钮
            toggleComplete(event.target);
        }

        // 添加按钮点击事件 - 当用户点击"添加"按钮时执行
        addBtn.addEventListener('click', function() {
            // 获取输入框的内容，并去除首尾空格
            const taskText = taskInput.value.trim();

            // 检查输入是否为空 - 如果为空就不添加任务
            if (taskText === '') {
                // 提示用户输入内容
                alert('请输入任务内容！');
                // 让输入框获得焦点，方便用户直接输入
                taskInput.focus();
                return;  // 停止执行后续代码
            }

            // 创建新的任务项元素 - 每个任务都是一个<li>
            const newTaskItem = document.createElement('li');
            newTaskItem.className = 'task-item';  // 添加CSS类名

            // 设置任务项的HTML内容 - 包含任务文本和操作按钮
            newTaskItem.innerHTML = `
                <span class="task-content">${taskText}</span>
                <div class="task-actions">
                    <button class="btn complete-btn">完成</button>
                    <button class="btn delete-btn">删除</button>
                </div>
            `;

            // 将新任务添加到任务列表的最顶部 - 在未完成任务之前
            // insertBefore(新元素, 第一个子元素) 会将新元素插入到第一个子元素之前
            taskList.insertBefore(newTaskItem, taskList.firstChild);

            // 为新添加的任务设置删除功能 - 重新设置所有删除按钮
            setupDeleteButtons();
            // 为新添加的任务设置完成功能 - 重新设置所有完成按钮
            setupCompleteButtons();

            // 清空输入框 - 方便用户添加下一个任务
            taskInput.value = '';

            // 让输入框重新获得焦点 - 提升用户体验
            taskInput.focus();

            // 保存任务到 localStorage
            saveTasks();
        });

        // 回车键添加任务 - 用户按回车也能添加任务
        taskInput.addEventListener('keypress', function(event) {
            // 检查是否按下了回车键（keyCode 13）
            if (event.key === 'Enter' || event.keyCode === 13) {
                addBtn.click();  // 模拟点击添加按钮
            }
        });

        // 清空已完成按钮点击事件
        clearCompletedBtn.addEventListener('click', function() {
            clearCompletedTasks();  // 清空所有已完成的任务
        });

        // 页面加载时，从 localStorage 读取并显示之前保存的任务
        loadTasks();

        // 初始化 - 为页面已有的任务设置功能
        setupDeleteButtons();  // 设置删除功能
        setupCompleteButtons();  // 设置完成功能
        updateClearCompletedButton();  // 更新清空按钮显示状态
    </script>
</body>
</html>
